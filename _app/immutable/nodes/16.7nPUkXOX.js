import{l as Jt,f as h,e as Z,a as f,r as Kt,t as Qt}from"../chunks/DA4zlYT6.js";import{i as Vt}from"../chunks/Bv-0c6t3.js";import{e as ht,ac as Xt,ar as Yt,aq as Zt,p as te,l as O,h as ee,f as ut,t as k,c as n,g as e,a as ae,s as l,d as v,m as I,r as o,as as re}from"../chunks/Dh6mP1wG.js";import{s as S}from"../chunks/DvvhDkJs.js";import{i as N}from"../chunks/BEFexrlf.js";import{e as tt,i as et}from"../chunks/BhqyOs_e.js";import{r as se,b as ie,a as oe}from"../chunks/ClQRzYlK.js";import{s as ne}from"../chunks/DDey6hSd.js";import{b as ft}from"../chunks/ByEUdlhv.js";import{s as le,a as _t}from"../chunks/BqAN62AK.js";import{b as de}from"../chunks/C9Pz-73a.js";import{E as ce}from"../chunks/CU0x5YWf.js";import{i as at}from"../chunks/Dsge_ew0.js";import{p as bt}from"../chunks/CD6oGcH5.js";import{D as ve}from"../chunks/DyxDYEzf.js";function gt(i,_,g){if(i.multiple){if(_==null)return;if(!Xt(_))return Yt();for(var m of i.options)m.selected=_.includes(M(m));return}for(m of i.options){var u=M(m);if(Zt(u,_)){m.selected=!0;return}}(!g||_!==void 0)&&(i.selectedIndex=-1)}function me(i,_){ht(()=>{var g=new MutationObserver(()=>{var m=i.__value;gt(i,m)});return g.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{g.disconnect()}})}function pe(i,_,g=_){var m=!0;Jt(i,"change",u=>{var y=u?"[selected]":":checked",D;if(i.multiple)D=[].map.call(i.querySelectorAll(y),M);else{var C=i.querySelector(y)??i.querySelector("option:not([disabled])");D=C&&M(C)}g(D)}),ht(()=>{var u=_();if(gt(i,u,m),m&&u===void 0){var y=i.querySelector(":checked");y!==null&&(u=M(y),g(u))}i.__value=u,m=!1}),me(i)}function M(i){return"__value"in i?i.__value:i.value}var ue=h("<option> </option>"),fe=h('<a class="badge text-bg-light text-decoration-none border"> </a>'),_e=h('<div class="d-flex mb-1 flex-wrap gap-1"></div> <small class="text-muted"> <!></small>',1),be=h('<span class="text-muted">Not linked</span>'),he=h("<span> </span>"),ge=h('<span class="text-muted">Not assessed</span>'),ye=h('<tr><td class="text-nowrap"> </td><td> </td><td> </td><td><!></td><td><!></td><td><div class="btn-group"><button class="btn btn-sm btn-outline-primary">Edit</button> <button class="btn btn-sm btn-outline-danger">Remove</button></div></td></tr>'),xe=h('<div class="table-responsive"><table class="table-striped table-bordered table align-middle"><thead class="table-light"><tr><th scope="col" style="width: 8rem;">ID</th><th scope="col">Description</th><th scope="col" style="width: 10rem;">Severity</th><th scope="col" style="width: 16rem;">Linked Hazards</th><th scope="col" style="width: 16rem;">Worst Assessed Risk</th><th scope="col" style="width: 12rem;">Actions</th></tr></thead><tbody></tbody></table></div>'),Ie=h('<div class="alert alert-info mb-0" role="alert">No impacts have been created yet. Add your first impact above.</div>'),ke=h('<div class="alert alert-secondary mb-0" role="alert">No impacts match your search.</div>'),Se=h(`<main class="container py-4"><h1 class="mb-2">Manage Impacts</h1> <p class="text-muted mb-4">Manage global impact definitions (description and severity). Likelihood and risk are assessed
		per hazard.</p> <div class="card mb-4"><div class="card-body"><h5 class="card-title">Add New Impact</h5> <div class="mb-3"><label for="impactDescription" class="form-label">Description</label> <div class="form-text mb-2">Describe the potential harm outcome linked to hazards in this case.</div> <textarea id="impactDescription" class="form-control" rows="2"></textarea></div> <div class="mb-3"><label for="impactSeverity" class="form-label">Severity</label> <select id="impactSeverity" class="form-select"><option disabled>Select severity</option><!></select></div> <button class="btn btn-primary">Add Impact</button></div></div> <div class="mb-3"><label for="impactSearch" class="form-label">Search impacts</label> <div class="form-text mb-2">Filter by ID, description, severity, linked hazard ID, or risk label.</div> <input id="impactSearch" type="text" class="form-control"/></div> <!></main> <!>`,1);function Oe(i,_){te(_,!1);const[g,m]=le(),u=()=>_t(bt,"$project",g),y=()=>_t(at,"$impacts",g),D=I(),C=I(),q=I(),P=I(),rt={Catastrophic:5,Major:4,Considerable:3,Significant:2,Minor:1,"Almost Certain":5,Likely:4,Possible:3,Unlikely:2,Rare:1},yt=["Catastrophic","Major","Considerable","Significant","Minor"],xt={1:"bg-success text-white",2:"bg-info text-dark",3:"bg-warning text-dark",4:"bg-danger text-white",5:"bg-danger text-white"};let E=I(""),R=I(null),L=I(!1),j=I(""),z=I("");function It(t){const s=t.reduce((a,d)=>{var x;const c=(x=d.id)==null?void 0:x.match(/\d+/);if(!c)return a;const r=Number.parseInt(c[0],10);return Number.isNaN(r)?a:Math.max(a,r)},0);return`I${String(s+1).padStart(2,"0")}`}function kt(t,s){const a=t?rt[t]:void 0,d=s?rt[s]:void 0;return!a||!d?null:ve.assess(a,d)}function St(){const t=e(j).trim();if(!t||!e(z)){alert("Please enter an impact description and select a severity.");return}at.update(s=>[...s,{id:It(s),description:t,severity:e(z)}]),v(j,""),v(z,"")}function Dt(t){v(R,t),v(L,!0)}function st(){v(L,!1)}function zt(t){confirm("Are you sure you want to remove this impact?")&&(at.update(s=>s.filter(a=>a.id!==t)),bt.update(s=>({...s,hazards:(s.hazards||[]).map(a=>({...a,impactIds:(a.impactIds||[]).filter(d=>d!==t),hazardImpacts:(a.hazardImpacts||[]).filter(d=>d.impactID!==t)}))})),e(R)===t&&(v(R,null),v(L,!1)))}O(()=>u(),()=>{v(D,(u().hazards||[]).reduce((t,s)=>{for(const a of s.hazardImpacts||[])a.impactID&&(t[a.impactID]||(t[a.impactID]=[]),t[a.impactID].push({hazardId:s.id,likelihood:a.likelihood}));return t},{}))}),O(()=>(y(),e(D)),()=>{v(C,y().map(t=>{const s=e(D)[t.id]||[],a=Array.from(new Set(s.map(r=>r.hazardId))).filter(r=>!!r),c=s.map(r=>kt(r.likelihood,t.severity)).filter(r=>r!==null).reduce((r,x)=>r&&r.score>=x.score?r:x,null);return{impact:t,hazardIds:a,usageCount:s.length,worstRisk:c}}).sort((t,s)=>t.impact.id.localeCompare(s.impact.id,void 0,{numeric:!0,sensitivity:"base"})))}),O(()=>e(E),()=>{v(q,e(E).trim().toLowerCase())}),O(()=>(e(C),e(q)),()=>{v(P,e(C).filter(t=>{var a;return e(q)?[t.impact.id,t.impact.description,t.impact.severity||"",((a=t.worstRisk)==null?void 0:a.rating)||"",...t.hazardIds].join(" ").toLowerCase().includes(e(q)):!0}))}),ee(),Vt();var it=Se(),H=ut(it),T=l(n(H),4),ot=n(T),U=l(n(ot),2),nt=l(n(U),4);Kt(nt),o(U);var W=l(U,2),G=l(n(W),2);k(()=>{e(z),re(()=>{})});var B=n(G);B.value=B.__value="";var Ct=l(B);tt(Ct,1,()=>yt,et,(t,s)=>{var a=ue(),d={},c=n(a,!0);o(a),k(()=>{d!==(d=e(s))&&(a.value=(a.__value=e(s))??""),S(c,e(s))}),f(t,a)}),o(G),o(W);var Nt=l(W,2);o(ot),o(T);var J=l(T,2),lt=l(n(J),4);se(lt),o(J);var Rt=l(J,2);{var $t=t=>{var s=xe(),a=n(s),d=l(n(a));tt(d,5,()=>e(P),et,(c,r)=>{var x=ye(),K=n(x),qt=n(K,!0);o(K);var Q=l(K),Et=n(Q,!0);o(Q);var V=l(Q),Lt=n(V,!0);o(V);var X=l(V),jt=n(X);{var Bt=p=>{var b=_e(),$=ut(b);tt($,5,()=>e(r).hazardIds.slice(0,4),et,(w,A)=>{var F=fe(),Gt=n(F,!0);o(F),k(()=>{oe(F,"href",`${de}/workspace/hazard?id=${e(A)}`),S(Gt,e(A))}),f(w,F)}),o($);var mt=l($,2),pt=n(mt),Ut=l(pt);{var Wt=w=>{var A=Qt();k(()=>S(A,`| +${e(r).hazardIds.length-4} more hazards`)),f(w,A)};N(Ut,w=>{e(r).hazardIds.length>4&&w(Wt)})}o(mt),k(()=>S(pt,`${e(r).usageCount??""} assessment${e(r).usageCount===1?"":"s"} `)),f(p,b)},Ft=p=>{var b=be();f(p,b)};N(jt,p=>{e(r).hazardIds.length?p(Bt):p(Ft,!1)})}o(X);var Y=l(X),Ot=n(Y);{var Pt=p=>{var b=he(),$=n(b);o(b),k(()=>{ne(b,1,`badge ${xt[e(r).worstRisk.score]}`),S($,`${e(r).worstRisk.rating??""} (${e(r).worstRisk.score??""})`)}),f(p,b)},Ht=p=>{var b=ge();f(p,b)};N(Ot,p=>{e(r).worstRisk?p(Pt):p(Ht,!1)})}o(Y);var dt=l(Y),ct=n(dt),vt=n(ct),Tt=l(vt,2);o(ct),o(dt),o(x),k(()=>{S(qt,e(r).impact.id),S(Et,e(r).impact.description),S(Lt,e(r).impact.severity||"Not set")}),Z("click",vt,()=>Dt(e(r).impact.id)),Z("click",Tt,()=>zt(e(r).impact.id)),f(c,x)}),o(d),o(a),o(s),f(t,s)},wt=(t,s)=>{{var a=c=>{var r=Ie();f(c,r)},d=c=>{var r=ke();f(c,r)};N(t,c=>{y().length===0?c(a):c(d,!1)},s)}};N(Rt,t=>{e(P).length?t($t):t(wt,!1)})}o(H);var At=l(H,2);{var Mt=t=>{ce(t,{get impactID(){return e(R)},$$events:{save:st,cancel:st}})};N(At,t=>{e(L)&&e(R)&&t(Mt)})}k(()=>ie(B,!e(z))),ft(nt,()=>e(j),t=>v(j,t)),pe(G,()=>e(z),t=>v(z,t)),Z("click",Nt,St),ft(lt,()=>e(E),t=>v(E,t)),f(i,it),ae(),m()}export{Oe as component};
