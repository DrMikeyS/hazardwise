import{f as u,e as J,a as p,r as Ut,t as Wt}from"../chunks/ChAviyHt.js";import{i as Gt}from"../chunks/qNE941fV.js";import{p as Jt,l as w,h as Kt,f as dt,t as h,c as o,g as e,a as Qt,s as l,d,m as b,r as i,o as Vt}from"../chunks/CXmlZRuw.js";import{s as _}from"../chunks/BUZbKzbf.js";import{i as y}from"../chunks/AaKCM-in.js";import{e as K,i as Q}from"../chunks/DqM6bYLX.js";import{r as Xt,b as Yt,a as Zt}from"../chunks/BcXK0Cv5.js";import{s as te}from"../chunks/daXtgChX.js";import{b as mt}from"../chunks/DSrdwlJO.js";import{b as ee}from"../chunks/DXL4SEhS.js";import{s as ae,a as pt}from"../chunks/BORQ0yCD.js";import{b as se}from"../chunks/CFYPu0N-.js";import{E as re}from"../chunks/C1Z6qnEd.js";import{i as V}from"../chunks/DFSBX4kA.js";import{p as vt}from"../chunks/nz0IzRFZ.js";import{D as ie}from"../chunks/D-dackkR.js";var oe=u("<option> </option>"),le=u('<a class="badge text-bg-light text-decoration-none border"> </a>'),ne=u('<div class="d-flex mb-1 flex-wrap gap-1"></div> <small class="text-muted"> <!></small>',1),ce=u('<span class="text-muted">Not linked</span>'),de=u("<span> </span>"),me=u('<span class="text-muted">Not assessed</span>'),pe=u('<tr><td class="text-nowrap"> </td><td> </td><td> </td><td><!></td><td><!></td><td><div class="btn-group"><button class="btn btn-sm btn-outline-primary">Edit</button> <button class="btn btn-sm btn-outline-danger">Remove</button></div></td></tr>'),ve=u('<div class="table-responsive"><table class="table-striped table-bordered table align-middle"><thead class="table-light"><tr><th scope="col" style="width: 8rem;">ID</th><th scope="col">Description</th><th scope="col" style="width: 10rem;">Severity</th><th scope="col" style="width: 16rem;">Linked Hazards</th><th scope="col" style="width: 16rem;">Worst Assessed Risk</th><th scope="col" style="width: 12rem;">Actions</th></tr></thead><tbody></tbody></table></div>'),ue=u('<div class="alert alert-info mb-0" role="alert">No impacts have been created yet. Add your first impact above.</div>'),fe=u('<div class="alert alert-secondary mb-0" role="alert">No impacts match your search.</div>'),be=u(`<main class="container py-4"><h1 class="mb-2">Manage Impacts</h1> <p class="text-muted mb-4">Manage global impact definitions (description and severity). Likelihood and risk are assessed
		per hazard.</p> <div class="card mb-4"><div class="card-body"><h5 class="card-title">Add New Impact</h5> <div class="mb-3"><label for="impactDescription" class="form-label">Description</label> <div class="form-text mb-2">Describe the potential harm outcome linked to hazards in this case.</div> <textarea id="impactDescription" class="form-control" rows="2"></textarea></div> <div class="mb-3"><label for="impactSeverity" class="form-label">Severity</label> <select id="impactSeverity" class="form-select"><option disabled>Select severity</option><!></select></div> <button class="btn btn-primary">Add Impact</button></div></div> <div class="mb-3"><label for="impactSearch" class="form-label">Search impacts</label> <div class="form-text mb-2">Filter by ID, description, severity, linked hazard ID, or risk label.</div> <input id="impactSearch" type="text" class="form-control"/></div> <!></main> <!>`,1);function Me(ut,ft){Jt(ft,!1);const[X,bt]=ae(),Y=()=>pt(vt,"$project",X),A=()=>pt(V,"$impacts",X),M=b(),E=b(),z=b(),j=b(),Z={Catastrophic:5,Major:4,Considerable:3,Significant:2,Minor:1,"Almost Certain":5,Likely:4,Possible:3,Unlikely:2,Rare:1},ht=["Catastrophic","Major","Considerable","Significant","Minor"],_t={1:"bg-success text-white",2:"bg-info text-dark",3:"bg-warning text-dark",4:"bg-danger text-white",5:"bg-danger text-white"};let S=b(""),x=b(null),C=b(!1),N=b(""),g=b("");function gt(t){const r=t.reduce((a,n)=>{var f;const c=(f=n.id)==null?void 0:f.match(/\d+/);if(!c)return a;const s=Number.parseInt(c[0],10);return Number.isNaN(s)?a:Math.max(a,s)},0);return`I${String(r+1).padStart(2,"0")}`}function yt(t,r){const a=t?Z[t]:void 0,n=r?Z[r]:void 0;return!a||!n?null:ie.assess(a,n)}function xt(){const t=e(N).trim();if(!t||!e(g)){alert("Please enter an impact description and select a severity.");return}V.update(r=>[...r,{id:gt(r),description:t,severity:e(g)}]),d(N,""),d(g,"")}function It(t){d(x,t),d(C,!0)}function tt(){d(C,!1)}function kt(t){confirm("Are you sure you want to remove this impact?")&&(V.update(r=>r.filter(a=>a.id!==t)),vt.update(r=>({...r,hazards:(r.hazards||[]).map(a=>({...a,impactIds:(a.impactIds||[]).filter(n=>n!==t),hazardImpacts:(a.hazardImpacts||[]).filter(n=>n.impactID!==t)}))})),e(x)===t&&(d(x,null),d(C,!1)))}w(()=>Y(),()=>{d(M,(Y().hazards||[]).reduce((t,r)=>{for(const a of r.hazardImpacts||[])a.impactID&&(t[a.impactID]||(t[a.impactID]=[]),t[a.impactID].push({hazardId:r.id,likelihood:a.likelihood}));return t},{}))}),w(()=>(A(),e(M)),()=>{d(E,A().map(t=>{const r=e(M)[t.id]||[],a=Array.from(new Set(r.map(s=>s.hazardId))).filter(s=>!!s),c=r.map(s=>yt(s.likelihood,t.severity)).filter(s=>s!==null).reduce((s,f)=>s&&s.score>=f.score?s:f,null);return{impact:t,hazardIds:a,usageCount:r.length,worstRisk:c}}).sort((t,r)=>t.impact.id.localeCompare(r.impact.id,void 0,{numeric:!0,sensitivity:"base"})))}),w(()=>e(S),()=>{d(z,e(S).trim().toLowerCase())}),w(()=>(e(E),e(z)),()=>{d(j,e(E).filter(t=>{var a;return e(z)?[t.impact.id,t.impact.description,t.impact.severity||"",((a=t.worstRisk)==null?void 0:a.rating)||"",...t.hazardIds].join(" ").toLowerCase().includes(e(z)):!0}))}),Kt(),Gt();var et=be(),L=dt(et),B=l(o(L),4),at=o(B),P=l(o(at),2),st=l(o(P),4);Ut(st),i(P);var q=l(P,2),F=l(o(q),2);h(()=>{e(g),Vt(()=>{})});var R=o(F);R.value=R.__value="";var Dt=l(R);K(Dt,1,()=>ht,Q,(t,r)=>{var a=oe(),n={},c=o(a,!0);i(a),h(()=>{n!==(n=e(r))&&(a.value=(a.__value=e(r))??""),_(c,e(r))}),p(t,a)}),i(F),i(q);var zt=l(q,2);i(at),i(B);var H=l(B,2),rt=l(o(H),4);Xt(rt),i(H);var St=l(H,2);{var Ct=t=>{var r=ve(),a=o(r),n=l(o(a));K(n,5,()=>e(j),Q,(c,s)=>{var f=pe(),O=o(f),wt=o(O,!0);i(O);var T=l(O),At=o(T,!0);i(T);var U=l(T),Mt=o(U,!0);i(U);var W=l(U),Et=o(W);{var jt=m=>{var v=ne(),I=dt(v);K(I,5,()=>e(s).hazardIds.slice(0,4),Q,(k,D)=>{var $=le(),Tt=o($,!0);i($),h(()=>{Zt($,"href",`${se}/workspace/hazard?id=${e(D)}`),_(Tt,e(D))}),p(k,$)}),i(I);var nt=l(I,2),ct=o(nt),Ht=l(ct);{var Ot=k=>{var D=Wt();h(()=>_(D,`| +${e(s).hazardIds.length-4} more hazards`)),p(k,D)};y(Ht,k=>{e(s).hazardIds.length>4&&k(Ot)})}i(nt),h(()=>_(ct,`${e(s).usageCount??""} assessment${e(s).usageCount===1?"":"s"} `)),p(m,v)},Lt=m=>{var v=ce();p(m,v)};y(Et,m=>{e(s).hazardIds.length?m(jt):m(Lt,!1)})}i(W);var G=l(W),Bt=o(G);{var Pt=m=>{var v=de(),I=o(v);i(v),h(()=>{te(v,1,`badge ${_t[e(s).worstRisk.score]}`),_(I,`${e(s).worstRisk.rating??""} (${e(s).worstRisk.score??""})`)}),p(m,v)},qt=m=>{var v=me();p(m,v)};y(Bt,m=>{e(s).worstRisk?m(Pt):m(qt,!1)})}i(G);var it=l(G),ot=o(it),lt=o(ot),Ft=l(lt,2);i(ot),i(it),i(f),h(()=>{_(wt,e(s).impact.id),_(At,e(s).impact.description),_(Mt,e(s).impact.severity||"Not set")}),J("click",lt,()=>It(e(s).impact.id)),J("click",Ft,()=>kt(e(s).impact.id)),p(c,f)}),i(n),i(a),i(r),p(t,r)},Nt=(t,r)=>{{var a=c=>{var s=ue();p(c,s)},n=c=>{var s=fe();p(c,s)};y(t,c=>{A().length===0?c(a):c(n,!1)},r)}};y(St,t=>{e(j).length?t(Ct):t(Nt,!1)})}i(L);var Rt=l(L,2);{var $t=t=>{re(t,{get impactID(){return e(x)},$$events:{save:tt,cancel:tt}})};y(Rt,t=>{e(C)&&e(x)&&t($t)})}h(()=>Yt(R,!e(g))),mt(st,()=>e(N),t=>d(N,t)),ee(F,()=>e(g),t=>d(g,t)),J("click",zt,xt),mt(rt,()=>e(S),t=>d(S,t)),p(ut,et),Qt(),bt()}export{Me as component};
