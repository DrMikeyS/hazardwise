import{c as ft,a as c,f as m,e as u,r as La,t as Ma}from"../chunks/Cg9Xl0Sa.js";import"../chunks/CfKYgX-v.js";import{p as Bt,i as na,f as it,a as Rt,s as r,c as i,r as e,t as dt,d as t,o as $a,l as q,b as Da,m as v,e as o,g as xt,n as ia,h as ra}from"../chunks/B56XX5F_.js";import{s as P}from"../chunks/BqzG54jq.js";import{i as w}from"../chunks/247NCbUc.js";import{e as lt,i as ct}from"../chunks/DLiX6WjV.js";import{b as Ot}from"../chunks/Dx0qbBmv.js";import{i as qt}from"../chunks/CpnGeK5l.js";import{s as Sa,a as At}from"../chunks/B45zb-iJ.js";import{p as Ha}from"../chunks/CJnYkIW-.js";import{g as Q,b as T}from"../chunks/C4YJHUZg.js";import{p as V}from"../chunks/CO5lv_UP.js";import{c as Ea,m as Na}from"../chunks/iOF0ue_n.js";import{i as ja}from"../chunks/D80wyiQx.js";import{H as It}from"../chunks/TbElzKSA.js";import{r as oa}from"../chunks/D3YDNmF4.js";import{p as ut}from"../chunks/DBHT1qGz.js";import{L as Aa}from"../chunks/e-nR0wtI.js";var Ba=m('<li class="list-group-item d-flex justify-content-between align-items-center"><div><strong> </strong><br/> <small> </small></div> <button class="btn btn-sm btn-outline-primary">Link</button></li>'),Ra=m('<ul class="list-group"></ul>'),Oa=m('<p class="text-muted">No matching impacts found.</p>'),qa=m('<div class="modal-backdrop fade show"></div> <div class="modal d-block" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Link Existing Impact</h5> <button type="button" class="btn-close"></button></div> <div class="modal-body"><input type="text" class="form-control mb-3" placeholder="Search impacts..."/> <!></div> <div class="modal-footer"><button class="btn btn-secondary">Close</button></div></div></div></div>',1);function Pa(vt,I){Bt(I,!1);let X=ut(I,"show",8,!1),Y=ut(I,"impacts",24,()=>[]),C=ut(I,"search",12,"");const _=na();function L(h){_("link",h)}function z(){_("close")}qt();var Z=ft(),tt=it(Z);{var at=h=>{var H=qa(),U=r(it(H),2),E=i(U),W=i(E),n=i(W),N=r(i(n),2);e(n);var l=r(n,2),x=i(l);oa(x);var F=r(x,2);{var G=g=>{var k=Ra();lt(k,5,Y,ct,(j,b)=>{var y=Ba(),A=i(y),et=i(A),mt=i(et,!0);e(et);var pt=r(et,3),zt=i(pt);e(pt),e(A);var wt=r(A,2);e(y),dt(()=>{P(mt,t(b).description),P(zt,`Likelihood: ${t(b).likelihood??""} | Severity: ${t(b).severity??""}`)}),u("click",wt,()=>L(t(b).id)),c(j,y)}),e(k),c(g,k)},J=(g,k)=>{{var j=b=>{var y=Oa();c(b,y)};w(g,b=>{C()&&b(j)},k)}};w(F,g=>{Y().length?g(G):g(J,!1)})}e(l);var M=r(l,2),K=i(M);e(M),e(W),e(E),e(U),u("click",N,z),Ot(x,C),u("click",K,z),c(h,H)};w(tt,h=>{X()&&h(at)})}c(vt,Z),Rt()}var Ua=m('<li class="list-group-item d-flex justify-content-between align-items-center"><div> </div> <button class="btn btn-sm btn-outline-primary">Link</button></li>'),Wa=m('<ul class="list-group"></ul>'),Fa=m('<p class="text-muted">No matching causes found.</p>'),Ga=m('<div class="modal-backdrop fade show"></div> <div class="modal d-block" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Link Existing Cause</h5> <button type="button" class="btn-close"></button></div> <div class="modal-body"><input type="text" class="form-control mb-3" placeholder="Search causes..."/> <!></div> <div class="modal-footer"><button class="btn btn-secondary">Close</button></div></div></div></div>',1);function Ja(vt,I){Bt(I,!1);let X=ut(I,"show",8,!1),Y=ut(I,"causes",24,()=>[]),C=ut(I,"search",12,"");const _=na();function L(h){_("link",h)}function z(){_("close")}qt();var Z=ft(),tt=it(Z);{var at=h=>{var H=Ga(),U=r(it(H),2),E=i(U),W=i(E),n=i(W),N=r(i(n),2);e(n);var l=r(n,2),x=i(l);oa(x);var F=r(x,2);{var G=g=>{var k=Wa();lt(k,5,Y,ct,(j,b)=>{var y=Ua(),A=i(y),et=i(A,!0);e(A);var mt=r(A,2);e(y),dt(()=>P(et,t(b).description)),u("click",mt,()=>L(t(b).id)),c(j,y)}),e(k),c(g,k)},J=(g,k)=>{{var j=b=>{var y=Fa();c(b,y)};w(g,b=>{C()&&b(j)},k)}};w(F,g=>{Y().length?g(G):g(J,!1)})}e(l);var M=r(l,2),K=i(M);e(M),e(W),e(E),e(U),u("click",N,z),Ot(x,C),u("click",K,z),c(h,H)};w(tt,h=>{X()&&h(at)})}c(vt,Z),Rt()}var Ka=m('<tr><td colspan="3" class="text-center text-muted">No causes added yet.</td></tr>'),Qa=m('<span class="text-muted">None</span>'),Ta=m('<tr><td> </td><td><!></td><td class="text-end"><div class="btn-group"><button class="btn btn-sm btn-outline-secondary">Edit</button> <button class="btn btn-sm btn-outline-danger">Remove</button></div></td></tr>'),Va=m('<li class="list-group-item d-flex justify-content-between align-items-center"><span> </span> <div class="btn-group"><button class="btn btn-sm btn-outline-secondary">Edit</button> <button class="btn btn-sm btn-outline-danger">Remove</button></div></li>'),Xa=m('<ul class="list-group mb-3"></ul>'),Ya=m('<p class="text-muted">No hazard-specific mitigations added.</p>'),Za=m('<tr><td> </td><td> </td><td> </td><td class="text-end"><div class="btn-group"><button class="btn btn-sm btn-outline-secondary">Edit</button> <button class="btn btn-sm btn-outline-danger">Remove</button></div></td></tr>'),te=m('<table class="table table-striped mb-3"><thead><tr><th>Description</th><th>Likelihood</th><th>Severity</th><th class="text-end">Actions</th></tr></thead><tbody></tbody></table>'),ae=m('<p class="text-muted mb-3">No impacts added yet.</p>'),ee=m('<main class="container py-4"><button class="btn btn-link mb-3">← Back to Workspace</button> <h1 class="mb-4">Edit Hazard</h1> <div class="mb-3"><label for="hazardDescription" class="form-label">Hazard Description</label> <textarea id="hazardDescription" class="form-control" rows="4" placeholder="Describe what might go wrong"></textarea> <div class="form-text">A hazard is anything that could potentially cause harm.</div></div> <details class="card mb-3"><summary class="card-header d-flex justify-content-between align-items-center"><strong>Causes</strong> <small class="text-muted">▼</small></summary> <div class="card-body"><table class="table table-striped"><thead><tr><th>Cause</th><th>Associated Mitigations</th><th class="text-end">Actions</th></tr></thead><tbody><!></tbody></table> <button class="btn btn-outline-primary">Add New Cause</button> <button class="btn btn-outline-secondary ms-2">Link Existing Cause</button></div></details> <details class="card mb-3"><summary class="card-header d-flex justify-content-between align-items-center"><strong>Hazard-Specific Mitigations</strong> <small class="text-muted">▼</small></summary> <div class="card-body"><!> <button class="btn btn-outline-primary">Add Hazard-Specific Mitigation</button> <button class="btn btn-outline-secondary ms-2">Link Existing Mitigation</button></div></details> <details class="card mb-3"><summary class="card-header d-flex justify-content-between align-items-center"><strong>Impacts</strong> <small class="text-muted">▼</small></summary> <div class="card-body"><!> <button class="btn btn-outline-primary">Add Impact</button> <button class="btn btn-outline-secondary ms-2">Link Existing Impact</button></div></details> <button class="btn btn-success mb-4">Save Hazard</button> <!> <!> <!></main>');function ye(vt,I){var aa,ea,sa;Bt(I,!1);const[X,Y]=Sa(),C=()=>At(Ea,"$causes",X),_=()=>At(Na,"$mitigations",X),L=()=>At(ja,"$impacts",X),z=v(),Z=v(),tt=v(),at=v(),h=v(),H=v(),U=v(),E=v(),W=v();let n=v(null),N=v(""),l=v(),x=v(!1),F=v(""),G=v(!1),J=v(""),M=v(!1),K=v(""),g=((aa=t(l))==null?void 0:aa.mitigationIds)||[],k=((ea=t(l))==null?void 0:ea.impactIds)||[],j=((sa=t(l))==null?void 0:sa.causeIds)||[];$a(()=>{if(o(n,Ha.url.searchParams.get("id")),t(n)){const a=xt(V);o(l,a.hazards.find(s=>s.id===t(n))),console.log("Loaded hazard:",t(l)),t(l)&&o(N,t(l).description)}});function b(){Q(T+"/workspace")}function y(a){Q(T+`/workspace/hazard/cause?hazardID=${t(n)}&causeID=${a}`)}function A(){gt(),Q(T+`/workspace/hazard/cause?hazardID=${t(n)}`)}function et(){gt(),Q(T+`/workspace/hazard/mitigation?hazardID=${t(n)}`)}function mt(){gt(),Q(T+`/workspace/hazard/impact?hazardID=${t(n)}`)}function pt(a){t(n)&&(V.update(s=>({...s,hazards:s.hazards.map(d=>{var p;return d.id===t(n)&&!((p=d.impactIds)!=null&&p.includes(a))?{...d,impactIds:[...d.impactIds||[],a]}:d})})),o(x,!1),o(l,xt(V).hazards.find(s=>s.id===t(n))))}function zt(a){t(n)&&(V.update(s=>({...s,hazards:s.hazards.map(d=>{var p;return d.id===t(n)&&!((p=d.causeIds)!=null&&p.includes(a))?{...d,causeIds:[...d.causeIds||[],a]}:d})})),o(G,!1),o(l,xt(V).hazards.find(s=>s.id===t(n))))}function wt(a){zt(a.detail)}function da(a){t(n)&&(V.update(s=>({...s,hazards:s.hazards.map(d=>{var p;return d.id===t(n)&&!((p=d.mitigationIds)!=null&&p.includes(a))?{...d,mitigationIds:[...d.mitigationIds||[],a]}:d})})),o(M,!1),o(l,xt(V).hazards.find(s=>s.id===t(n))))}function la(a){da(a.detail)}function ca(a){t(n)&&o(l,It.removeImpact(t(n),a))}function ua(a){t(n)&&o(l,It.removeCause(t(n),a))}function va(a){t(n)&&o(l,It.removeHazardMitigation(t(n),a))}function ma(a){pt(a.detail)}function gt(){if(!t(n)){const a=It.saveNewHazard(t(N));o(n,a.id),o(l,a.hazardObj)}}function ba(){gt(),V.update(a=>({...a,hazards:a.hazards.map(s=>s.id===t(n)?{...s,description:t(N)}:s)})),Q(T+"/workspace")}q(()=>(t(l),C()),()=>{var a;o(z,(((a=t(l))==null?void 0:a.causeIds)||[]).map(s=>C().find(d=>d.id===s)).filter(Boolean))}),q(()=>(t(z),_()),()=>{o(Z,t(z).flatMap(a=>a.mitigationIds||[]).map(a=>_().find(s=>s.id===a)).filter(Boolean))}),q(()=>(t(l),_()),()=>{var a;o(tt,(((a=t(l))==null?void 0:a.mitigationIds)||[]).map(s=>_().find(d=>d.id===s)).filter(Boolean))}),q(()=>L(),()=>{o(at,L())}),q(()=>(t(at),t(F)),()=>{o(h,t(at).filter(a=>a.description.toLowerCase().includes(t(F).toLowerCase())&&!k.includes(a.id)))}),q(()=>C(),()=>{o(H,C())}),q(()=>(t(H),t(J)),()=>{o(U,t(H).filter(a=>a.description.toLowerCase().includes(t(J).toLowerCase())&&!j.includes(a.id)))}),q(()=>_(),()=>{o(E,_())}),q(()=>(t(E),t(K)),()=>{o(W,t(E).filter(a=>a.description.toLowerCase().includes(t(K).toLowerCase())&&!g.includes(a.id)))}),Da(),qt();var Ct=ee(),Pt=i(Ct),Lt=r(Pt,4),Ut=r(i(Lt),2);La(Ut),ia(2),e(Lt);var Mt=r(Lt,2),Wt=r(i(Mt),2),$t=i(Wt),Ft=r(i($t)),fa=i(Ft);{var pa=a=>{var s=Ka();c(a,s)},ga=a=>{var s=ft(),d=it(s);lt(d,1,()=>t(z),ct,(p,f)=>{var $=Ta(),st=i($),rt=i(st,!0);e(st);var D=r(st),B=i(D);{var bt=R=>{var S=ft(),_t=it(S);lt(_t,1,()=>t(f).mitigationIds,ct,(Nt,O,jt)=>{ia();var kt=Ma();dt(yt=>P(kt,`${yt??""}
                      ${jt<t(f).mitigationIds.length-1?", ":""}`),[()=>{var yt;return(yt=_().find(Ca=>Ca.id===t(O)))==null?void 0:yt.description}],ra),c(Nt,kt)}),c(R,S)},Ht=R=>{var S=Qa();c(R,S)};w(B,R=>{var S;(S=t(f).mitigationIds)!=null&&S.length?R(bt):R(Ht,!1)})}e(D);var nt=r(D),ht=i(nt),ot=i(ht),Et=r(ot,2);e(ht),e(nt),e($),dt(()=>P(rt,t(f).description)),u("click",ot,()=>y(t(f).id)),u("click",Et,()=>ua(t(f).id)),c(p,$)}),c(a,s)};w(fa,a=>{t(z).length===0?a(pa):a(ga,!1)})}e(Ft),e($t);var Gt=r($t,2),ha=r(Gt,2);e(Wt),e(Mt);var Dt=r(Mt,2),Jt=r(i(Dt),2),Kt=i(Jt);{var _a=a=>{var s=Xa();lt(s,5,()=>t(tt),ct,(d,p)=>{var f=Va(),$=i(f),st=i($,!0);e($);var rt=r($,2),D=i(rt),B=r(D,2);e(rt),e(f),dt(()=>P(st,t(p).description)),u("click",D,()=>Q(T+`/workspace/hazard/mitigation?hazardID=${t(n)}&mitigationID=${t(p).id}`)),u("click",B,()=>va(t(p).id)),c(d,f)}),e(s),c(a,s)},ka=a=>{var s=Ya();c(a,s)};w(Kt,a=>{t(tt).length?a(_a):a(ka,!1)})}var Qt=r(Kt,2),ya=r(Qt,2);e(Jt),e(Dt);var St=r(Dt,2),Tt=r(i(St),2),Vt=i(Tt);{var xa=a=>{var s=te(),d=r(i(s));lt(d,5,()=>t(l).impactIds,ct,(p,f)=>{var $=ft(),st=it($);{var rt=D=>{var B=Za(),bt=i(B),Ht=i(bt,!0);e(bt);var nt=r(bt),ht=i(nt,!0);e(nt);var ot=r(nt),Et=i(ot,!0);e(ot);var R=r(ot),S=i(R),_t=i(S),Nt=r(_t,2);e(S),e(R),e(B),dt((O,jt,kt)=>{P(Ht,O),P(ht,jt),P(Et,kt)},[()=>L().find(O=>O.id===t(f)).description,()=>L().find(O=>O.id===t(f)).likelihood,()=>L().find(O=>O.id===t(f)).severity],ra),u("click",_t,()=>Q(T+`/workspace/hazard/impact?hazardID=${t(n)}&impactID=${t(f)}`)),u("click",Nt,()=>ca(t(f))),c(D,B)};w(st,D=>{L().find(B=>B.id===t(f))&&D(rt)})}c(p,$)}),e(d),e(s),c(a,s)},Ia=a=>{var s=ae();c(a,s)};w(Vt,a=>{var s,d;(d=(s=t(l))==null?void 0:s.impactIds)!=null&&d.length?a(xa):a(Ia,!1)})}var Xt=r(Vt,2),za=r(Xt,2);e(Tt),e(St);var Yt=r(St,2),Zt=r(Yt,2);Pa(Zt,{get show(){return t(x)},get impacts(){return t(h)},get search(){return t(F)},set search(a){o(F,a)},$$events:{link:ma,close:()=>o(x,!1)},$$legacy:!0});var ta=r(Zt,2);Ja(ta,{get show(){return t(G)},get causes(){return t(U)},get search(){return t(J)},set search(a){o(J,a)},$$events:{link:wt,close:()=>o(G,!1)},$$legacy:!0});var wa=r(ta,2);Aa(wa,{get show(){return t(M)},get mitigations(){return t(W)},get search(){return t(K)},set search(a){o(K,a)},$$events:{link:la,close:()=>o(M,!1)},$$legacy:!0}),e(Ct),u("click",Pt,b),Ot(Ut,()=>t(N),a=>o(N,a)),u("click",Gt,A),u("click",ha,()=>o(G,!0)),u("click",Qt,et),u("click",ya,()=>o(M,!0)),u("click",Xt,mt),u("click",za,()=>o(x,!0)),u("click",Yt,ba),c(vt,Ct),Rt(),Y()}export{ye as component};
