import{f as D,a as I}from"../chunks/D_RzRloE.js";import"../chunks/DlkhPo0f.js";import{o as pe}from"../chunks/C6l1qoH3.js";import{p as me,l as B,b as ue,t as w,g as e,a as ve,s as o,c as l,d as u,m as g,r as i}from"../chunks/q1fHjrPM.js";import{s as b}from"../chunks/DFReBX1E.js";import{i as be}from"../chunks/BPmOuZDw.js";import{e as W,i as Y}from"../chunks/DLTYB1tx.js";import{r as F}from"../chunks/DrLGDOvE.js";import{s as L}from"../chunks/DxbVduXn.js";import{e as G,r as fe}from"../chunks/DiVBmCPK.js";import{c as J}from"../chunks/i5w7oQmI.js";import{b as ge,a as K}from"../chunks/wQEDsBu3.js";import{i as he}from"../chunks/BpamrcWA.js";import{g as ye}from"../chunks/BYSN6vaU.js";import{p as Q}from"../chunks/BVwVK5X-.js";import{p as _e}from"../chunks/D2aCM8w_.js";import{i as T}from"../chunks/C5hiBbar.js";import{g as V}from"../chunks/C4NZD1wh.js";import{b as X}from"../chunks/Dv3iMXi1.js";import{D as Z}from"../chunks/BoGFcRCe.js";var xe=D('<tr><td class="text-nowrap"><input type="radio" name="severity" class="form-check-input me-2"/> <strong> </strong></td><td> </td></tr>'),ke=D('<tr><td class="text-nowrap"><input type="radio" name="likelihood" class="form-check-input me-2"/> <strong> </strong></td><td> </td></tr>'),Ie=D('<div class="mt-4"><h5>Calculated Risk Rating</h5> <div> </div> <div class="form-text"> </div></div>'),we=D('<main class="container py-4"><button class="btn btn-link mb-3">‚Üê Back to Hazard</button> <h1 class="mb-4"> </h1> <div class="mb-3"><label for="impactDescription" class="form-label">Impact Description</label> <textarea id="impactDescription" class="form-control" rows="3" placeholder="e.g. Incorrect clinical advice leads to unsafe prescription"></textarea></div> <h5 class="mt-4">Severity</h5> <table class="table table-bordered align-middle"><tbody></tbody></table> <h5 class="mt-4">Likelihood</h5> <table class="table table-bordered align-middle"><tbody></tbody></table> <!> <button class="btn btn-success mt-4"> </button></main>');function Fe(ee,te){me(te,!1);const x=g(),v=g(),ae=[],re=[];let k=null,n=g(null),h=g(""),p=g(""),m=g("");const ie=[{value:"Catastrophic",label:"Catastrophic",description:"Death; permanent life-changing incapacity; or severe injury/incapacity from which recovery is not expected in the short term. [Multiple patients]",class:"table-danger"},{value:"Major",label:"Major",description:"[Single patient:] death or permanent life-changing incapacity not recoverable. [Multiple patients:] severe injury/incapacity recoverable; severe psychological trauma.",class:"table-warning"},{value:"Considerable",label:"Considerable",description:"Severe injury/incapacity from which recovery is expected in the short term; severe psychological trauma. [Single or multiple patients]",class:"table-info"},{value:"Significant",label:"Significant",description:"Minor injury or injuries from which recovery is not expected in the short term; significant psychological trauma. [Single or multiple patients]",class:""},{value:"Minor",label:"Minor",description:"Minor injury from which recovery is expected in the short term; minor psychological upset or inconvenience. [Single or multiple patients]",class:"table-secondary text-white"}],se=[{value:"Almost Certain",label:"Almost Certain",description:"Expected to occur frequently",class:"table-danger"},{value:"Likely",label:"Likely",description:"Will probably occur occasionally",class:"table-warning"},{value:"Possible",label:"Possible",description:"Could occur but uncommon",class:"table-info"},{value:"Unlikely",label:"Unlikely",description:"Rare but possible",class:""},{value:"Rare",label:"Rare",description:"Exceptional circumstances only",class:"table-secondary text-white"}],le={1:"bg-success text-white",2:"bg-info text-dark",3:"bg-warning text-dark",4:"bg-danger text-white",5:"bg-danger text-white"},f={Catastrophic:5,Major:4,Moderate:3,Minor:2,Negligible:1,"Almost Certain":5,Likely:4,Possible:3,Unlikely:2,Rare:1};pe(()=>{if(k=Q.url.searchParams.get("hazardID"),u(n,Q.url.searchParams.get("impactID")),k||(alert("You must specify a hazard."),V(X+"/workspace")),e(n)){const a=ye(T).find(t=>t.id===e(n));a&&(u(h,a.description),u(p,a.severity),u(m,a.likelihood))}});function E(){V(X+`/workspace/hazard?id=${k}`)}function oe(){if(!e(p)||!e(m)){alert("Please select both severity and likelihood.");return}e(x),e(v).rating,T.update(a=>{if(e(n))return a.map(t=>t.id===e(n)?{...t,description:e(h),severity:e(p)}:t);{const t=a.length+1,r=`I${String(t).padStart(2,"0")}`;return u(n,r),[...a,{id:r,description:e(h),severity:e(p)}]}}),e(n)&&_e.update(a=>({...a,hazards:a.hazards.map(t=>{var s;if(t.id!==k)return t;const r=(s=t.hazardImpacts)==null?void 0:s.some(d=>d.impactID===e(n)),c={impactID:e(n),likelihood:e(m)};return{...t,hazardImpacts:r?t.hazardImpacts.map(d=>d.impactID===e(n)?c:d):[...t.hazardImpacts||[],c]}})})),E()}B(()=>(e(p),e(m)),()=>{u(x,(f[e(p)]||0)*(f[e(m)]||0))}),B(()=>(e(p),e(m),Z),()=>{u(v,f[e(p)]&&f[e(m)]?Z.assess(f[e(m)],f[e(p)]):null)}),B(()=>(e(v),e(x)),()=>{console.log("Risk assessment:",e(v),e(x))}),ue(),he();var S=we(),U=l(S),C=o(U,2),ne=l(C,!0);i(C);var M=o(C,2),O=o(l(M),2);fe(O),i(M);var z=o(M,4),q=l(z);W(q,5,()=>ie,Y,(a,t)=>{var r=xe(),c=l(r),s=l(c);F(s);var d,y=o(s,2),P=l(y,!0);i(y),i(c);var _=o(c),$=l(_,!0);i(_),i(r),w(()=>{L(r,1,J(e(t).class)),d!==(d=e(t).value)&&(s.value=(s.__value=e(t).value)??""),b(P,e(t).label),b($,e(t).description)}),K(ae,[],s,()=>(e(t).value,e(p)),A=>u(p,A)),I(a,r)}),i(q),i(z);var j=o(z,4),H=l(j);W(H,5,()=>se,Y,(a,t)=>{var r=ke(),c=l(r),s=l(c);F(s);var d,y=o(s,2),P=l(y,!0);i(y),i(c);var _=o(c),$=l(_,!0);i(_),i(r),w(()=>{L(r,1,J(e(t).class)),d!==(d=e(t).value)&&(s.value=(s.__value=e(t).value)??""),b(P,e(t).label),b($,e(t).description)}),K(re,[],s,()=>(e(t).value,e(m)),A=>u(m,A)),I(a,r)}),i(H),i(j);var N=o(j,2);{var ce=a=>{var t=Ie(),r=o(l(t),2),c=l(r);i(r);var s=o(r,2),d=l(s,!0);i(s),i(t),w(()=>{L(r,1,`badge ${le[e(v).score]}`),b(c,`${e(v).rating??""} (${e(v).score??""} pts)`),b(d,e(v).definition)}),I(a,t)};be(N,a=>{e(v)&&a(ce)})}var R=o(N,2),de=l(R,!0);i(R),i(S),w(()=>{b(ne,e(n)?"Edit Impact":"Add Impact"),b(de,e(n)?"Save Impact":"Add Impact")}),G("click",U,E),ge(O,()=>e(h),a=>u(h,a)),G("click",R,oe),I(ee,S),ve()}export{Fe as component};
