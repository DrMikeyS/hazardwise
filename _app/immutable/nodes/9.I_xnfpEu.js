import{f as C,a as I}from"../chunks/ByznTNP7.js";import"../chunks/C_lvEoKA.js";import{o as pe}from"../chunks/YcAVyAIa.js";import{p as me,l as w,b as ve,t as S,g as e,a as ue,s as n,c as l,d as v,m as g,r as i}from"../chunks/Byf_APSn.js";import{s as b}from"../chunks/D1JRKF2H.js";import{i as be}from"../chunks/CcvN5397.js";import{e as Y,i as F}from"../chunks/B83NqsiQ.js";import{r as G}from"../chunks/kCS1cBXX.js";import{s as B}from"../chunks/CSUnCBv_.js";import{e as J,r as fe}from"../chunks/lQ2wvMXm.js";import{c as K}from"../chunks/i5w7oQmI.js";import{b as ge,a as N}from"../chunks/DtrvLAjM.js";import{i as he}from"../chunks/BX2uTXUe.js";import{g as ye}from"../chunks/C4JyVH-E.js";import{p as Q}from"../chunks/BvgVBj-f.js";import{p as _e}from"../chunks/B_E1uZGf.js";import{i as T}from"../chunks/CQIGJNRs.js";import{g as V}from"../chunks/CuOFMt8c.js";import{b as X}from"../chunks/DlhG-goq.js";import{D as Z}from"../chunks/bTbAdTPp.js";var xe=C('<tr><td class="text-nowrap"><input type="radio" name="severity" class="form-check-input me-2"/> <strong> </strong></td><td> </td></tr>'),ke=C('<tr><td class="text-nowrap"><input type="radio" name="likelihood" class="form-check-input me-2"/> <strong> </strong></td><td> </td></tr>'),Ie=C('<div class="mt-4"><h5>Calculated Risk Rating</h5> <div> </div> <div class="form-text"> </div></div>'),we=C('<main class="container py-4"><button class="btn btn-link mb-3">‚Üê Back to Hazard</button> <h1 class="mb-4"> </h1> <div class="mb-3"><label for="impactDescription" class="form-label">Impact Description</label> <textarea id="impactDescription" class="form-control" rows="3" placeholder="e.g. Incorrect clinical advice leads to unsafe prescription"></textarea></div> <h5 class="mt-4">Severity</h5> <table class="table table-bordered align-middle"><tbody></tbody></table> <h5 class="mt-4">Likelihood</h5> <table class="table table-bordered align-middle"><tbody></tbody></table> <!> <button class="btn btn-success mt-4"> </button></main>');function Ge(ee,te){me(te,!1);const x=g(),u=g(),ae=[],re=[];let k=null,c=g(null),h=g(""),o=g(""),d=g("");const ie=[{value:"Catastrophic",label:"Catastrophic",description:"Death; permanent life-changing incapacity; or severe injury/incapacity from which recovery is not expected in the short term. [Multiple patients]",class:"table-danger"},{value:"Major",label:"Major",description:"[Single patient:] death or permanent life-changing incapacity not recoverable. [Multiple patients:] severe injury/incapacity recoverable; severe psychological trauma.",class:"table-warning"},{value:"Considerable",label:"Considerable",description:"Severe injury/incapacity from which recovery is expected in the short term; severe psychological trauma. [Single or multiple patients]",class:"table-info"},{value:"Significant",label:"Significant",description:"Minor injury or injuries from which recovery is not expected in the short term; significant psychological trauma. [Single or multiple patients]",class:""},{value:"Minor",label:"Minor",description:"Minor injury from which recovery is expected in the short term; minor psychological upset or inconvenience. [Single or multiple patients]",class:"table-secondary text-white"}],se=[{value:"Almost Certain",label:"Almost Certain",description:"Expected to occur frequently",class:"table-danger"},{value:"Likely",label:"Likely",description:"Will probably occur occasionally",class:"table-warning"},{value:"Possible",label:"Possible",description:"Could occur but uncommon",class:"table-info"},{value:"Unlikely",label:"Unlikely",description:"Rare but possible",class:""},{value:"Rare",label:"Rare",description:"Exceptional circumstances only",class:"table-secondary text-white"}],le={1:"bg-success text-white",2:"bg-info text-dark",3:"bg-warning text-dark",4:"bg-danger text-white",5:"bg-danger text-white"},f={Catastrophic:5,Major:4,Considerable:3,Significant:2,Minor:1,"Almost Certain":5,Likely:4,Possible:3,Unlikely:2,Rare:1};pe(()=>{if(k=Q.url.searchParams.get("hazardID"),v(c,Q.url.searchParams.get("impactID")),k||(alert("You must specify a hazard."),V(X+"/workspace")),e(c)){const a=ye(T).find(t=>t.id===e(c));a&&(v(h,a.description),v(o,a.severity),v(d,a.likelihood))}});function E(){V(X+`/workspace/hazard?id=${k}`)}function oe(){if(!e(o)||!e(d)){alert("Please select both severity and likelihood.");return}e(x),e(u).rating,T.update(a=>{if(e(c))return a.map(t=>t.id===e(c)?{...t,description:e(h),severity:e(o)}:t);{const t=a.length+1,r=`I${String(t).padStart(2,"0")}`;return v(c,r),[...a,{id:r,description:e(h),severity:e(o)}]}}),e(c)&&_e.update(a=>({...a,hazards:a.hazards.map(t=>{var s;if(t.id!==k)return t;const r=(s=t.hazardImpacts)==null?void 0:s.some(m=>m.impactID===e(c)),p={impactID:e(c),likelihood:e(d)};return{...t,hazardImpacts:r?t.hazardImpacts.map(m=>m.impactID===e(c)?p:m):[...t.hazardImpacts||[],p]}})})),E()}w(()=>(e(o),e(d)),()=>{v(x,(f[e(o)]||0)*(f[e(d)]||0))}),w(()=>(e(o),e(d),Z),()=>{v(u,f[e(o)]&&f[e(d)]?Z.assess(f[e(d)],f[e(o)]):null)}),w(()=>(e(o),e(d)),()=>{console.log("Levels",e(o),e(d),f)}),w(()=>(e(u),e(x)),()=>{console.log("Risk assessment:",e(u),e(x))}),ve(),he();var D=we(),U=l(D),z=n(U,2),ne=l(z,!0);i(z);var M=n(z,2),O=n(l(M),2);fe(O),i(M);var j=n(M,4),q=l(j);Y(q,5,()=>ie,F,(a,t)=>{var r=xe(),p=l(r),s=l(p);G(s);var m,y=n(s,2),$=l(y,!0);i(y),i(p);var _=n(p),A=l(_,!0);i(_),i(r),S(()=>{B(r,1,K(e(t).class)),m!==(m=e(t).value)&&(s.value=(s.__value=e(t).value)??""),b($,e(t).label),b(A,e(t).description)}),N(ae,[],s,()=>(e(t).value,e(o)),L=>v(o,L)),I(a,r)}),i(q),i(j);var R=n(j,4),H=l(R);Y(H,5,()=>se,F,(a,t)=>{var r=ke(),p=l(r),s=l(p);G(s);var m,y=n(s,2),$=l(y,!0);i(y),i(p);var _=n(p),A=l(_,!0);i(_),i(r),S(()=>{B(r,1,K(e(t).class)),m!==(m=e(t).value)&&(s.value=(s.__value=e(t).value)??""),b($,e(t).label),b(A,e(t).description)}),N(re,[],s,()=>(e(t).value,e(d)),L=>v(d,L)),I(a,r)}),i(H),i(R);var W=n(R,2);{var ce=a=>{var t=Ie(),r=n(l(t),2),p=l(r);i(r);var s=n(r,2),m=l(s,!0);i(s),i(t),S(()=>{B(r,1,`badge ${le[e(u).score]}`),b(p,`${e(u).rating??""} (${e(u).score??""} pts)`),b(m,e(u).definition)}),I(a,t)};be(W,a=>{e(u)&&a(ce)})}var P=n(W,2),de=l(P,!0);i(P),i(D),S(()=>{b(ne,e(c)?"Edit Impact":"Add Impact"),b(de,e(c)?"Save Impact":"Add Impact")}),J("click",U,E),ge(O,()=>e(h),a=>v(h,a)),J("click",P,oe),I(ee,D),ue()}export{Ge as component};
