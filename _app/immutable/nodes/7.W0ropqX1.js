import{f as D,e as W,a as I,r as pe}from"../chunks/BigRneoS.js";import"../chunks/DhYZTW0n.js";import{p as me,o as ue,l as B,b as ve,t as w,d as e,a as be,s as o,c as l,e as u,m as g,g as he,r as i}from"../chunks/Dp4XvV4q.js";import{s as b}from"../chunks/R0xEnjdg.js";import{i as ge}from"../chunks/DUX-zM3N.js";import{e as Y,i as F}from"../chunks/U-ZPKxaM.js";import{r as G}from"../chunks/Dksa84ow.js";import{s as L}from"../chunks/CzmjAKHn.js";import{c as J}from"../chunks/i5w7oQmI.js";import{b as fe,a as K}from"../chunks/BcZp7PTO.js";import{i as ye}from"../chunks/DeQT2YmM.js";import{p as Q}from"../chunks/CMg1VSn_.js";import{p as _e}from"../chunks/B4aGxuZ6.js";import{i as T,D as V}from"../chunks/C7PnQIMN.js";import{g as X}from"../chunks/CC_0R2Wk.js";import{b as Z}from"../chunks/DoDhfopV.js";var xe=D('<tr><td class="text-nowrap"><input type="radio" name="severity" class="form-check-input me-2"/> <strong> </strong></td><td> </td></tr>'),ke=D('<tr><td class="text-nowrap"><input type="radio" name="likelihood" class="form-check-input me-2"/> <strong> </strong></td><td> </td></tr>'),Ie=D('<div class="mt-4"><h5>Calculated Risk Rating</h5> <div> </div> <div class="form-text"> </div></div>'),we=D('<main class="container py-4"><button class="btn btn-link mb-3">‚Üê Back to Hazard</button> <h1 class="mb-4"> </h1> <div class="mb-3"><label for="impactDescription" class="form-label">Impact Description</label> <textarea id="impactDescription" class="form-control" rows="3" placeholder="e.g. Incorrect clinical advice leads to unsafe prescription"></textarea></div> <h5 class="mt-4">Severity</h5> <table class="table table-bordered align-middle"><tbody></tbody></table> <h5 class="mt-4">Likelihood</h5> <table class="table table-bordered align-middle"><tbody></tbody></table> <!> <button class="btn btn-success mt-4"> </button></main>');function He(ee,te){me(te,!1);const x=g(),v=g(),ae=[],re=[];let k=null,n=g(null),f=g(""),p=g(""),m=g("");const ie=[{value:"Catastrophic",label:"Catastrophic",description:"Death; permanent life-changing incapacity; or severe injury/incapacity from which recovery is not expected in the short term. [Multiple patients]",class:"table-danger"},{value:"Major",label:"Major",description:"[Single patient:] death or permanent life-changing incapacity not recoverable. [Multiple patients:] severe injury/incapacity recoverable; severe psychological trauma.",class:"table-warning"},{value:"Considerable",label:"Considerable",description:"Severe injury/incapacity from which recovery is expected in the short term; severe psychological trauma. [Single or multiple patients]",class:"table-info"},{value:"Significant",label:"Significant",description:"Minor injury or injuries from which recovery is not expected in the short term; significant psychological trauma. [Single or multiple patients]",class:""},{value:"Minor",label:"Minor",description:"Minor injury from which recovery is expected in the short term; minor psychological upset or inconvenience. [Single or multiple patients]",class:"table-secondary text-white"}],se=[{value:"Almost Certain",label:"Almost Certain",description:"Expected to occur frequently",class:"table-danger"},{value:"Likely",label:"Likely",description:"Will probably occur occasionally",class:"table-warning"},{value:"Possible",label:"Possible",description:"Could occur but uncommon",class:"table-info"},{value:"Unlikely",label:"Unlikely",description:"Rare but possible",class:""},{value:"Rare",label:"Rare",description:"Exceptional circumstances only",class:"table-secondary text-white"}],le={1:"bg-success text-white",2:"bg-info text-dark",3:"bg-warning text-dark",4:"bg-danger text-white",5:"bg-danger text-white"},h={Catastrophic:5,Major:4,Moderate:3,Minor:2,Negligible:1,"Almost Certain":5,Likely:4,Possible:3,Unlikely:2,Rare:1};ue(()=>{if(k=Q.url.searchParams.get("hazardID"),u(n,Q.url.searchParams.get("impactID")),k||(alert("You must specify a hazard."),X(Z+"/workspace")),e(n)){const a=he(T).find(t=>t.id===e(n));a&&(u(f,a.description),u(p,a.severity),u(m,a.likelihood))}});function E(){X(Z+`/workspace/hazard?id=${k}`)}function oe(){if(!e(p)||!e(m)){alert("Please select both severity and likelihood.");return}e(x),e(v).rating,T.update(a=>{if(e(n))return a.map(t=>t.id===e(n)?{...t,description:e(f),severity:e(p)}:t);{const t=a.length+1,r=`I${String(t).padStart(2,"0")}`;return u(n,r),[...a,{id:r,description:e(f),severity:e(p)}]}}),e(n)&&_e.update(a=>({...a,hazards:a.hazards.map(t=>{var s;if(t.id!==k)return t;const r=(s=t.hazardImpacts)==null?void 0:s.some(d=>d.impactID===e(n)),c={impactID:e(n),likelihood:e(m)};return{...t,hazardImpacts:r?t.hazardImpacts.map(d=>d.impactID===e(n)?c:d):[...t.hazardImpacts||[],c]}})})),E()}B(()=>(e(p),e(m)),()=>{u(x,(h[e(p)]||0)*(h[e(m)]||0))}),B(()=>(e(p),e(m),V),()=>{u(v,h[e(p)]&&h[e(m)]?V.assess(h[e(m)],h[e(p)]):null)}),B(()=>(e(v),e(x)),()=>{console.log("Risk assessment:",e(v),e(x))}),ve(),ye();var S=we(),U=l(S),C=o(U,2),ne=l(C,!0);i(C);var M=o(C,2),O=o(l(M),2);pe(O),i(M);var z=o(M,4),q=l(z);Y(q,5,()=>ie,F,(a,t)=>{var r=xe(),c=l(r),s=l(c);G(s);var d,y=o(s,2),P=l(y,!0);i(y),i(c);var _=o(c),$=l(_,!0);i(_),i(r),w(()=>{L(r,1,J(e(t).class)),d!==(d=e(t).value)&&(s.value=(s.__value=e(t).value)??""),b(P,e(t).label),b($,e(t).description)}),K(ae,[],s,()=>(e(t).value,e(p)),A=>u(p,A)),I(a,r)}),i(q),i(z);var j=o(z,4),H=l(j);Y(H,5,()=>se,F,(a,t)=>{var r=ke(),c=l(r),s=l(c);G(s);var d,y=o(s,2),P=l(y,!0);i(y),i(c);var _=o(c),$=l(_,!0);i(_),i(r),w(()=>{L(r,1,J(e(t).class)),d!==(d=e(t).value)&&(s.value=(s.__value=e(t).value)??""),b(P,e(t).label),b($,e(t).description)}),K(re,[],s,()=>(e(t).value,e(m)),A=>u(m,A)),I(a,r)}),i(H),i(j);var N=o(j,2);{var ce=a=>{var t=Ie(),r=o(l(t),2),c=l(r);i(r);var s=o(r,2),d=l(s,!0);i(s),i(t),w(()=>{L(r,1,`badge ${le[e(v).score]}`),b(c,`${e(v).rating??""} (${e(v).score??""} pts)`),b(d,e(v).definition)}),I(a,t)};ge(N,a=>{e(v)&&a(ce)})}var R=o(N,2),de=l(R,!0);i(R),i(S),w(()=>{b(ne,e(n)?"Edit Impact":"Add Impact"),b(de,e(n)?"Save Impact":"Add Impact")}),W("click",U,E),fe(O,()=>e(f),a=>u(f,a)),W("click",R,oe),I(ee,S),be()}export{He as component};
