import{f as x,a as p,c as gt}from"../chunks/EuKFVhsR.js";import"../chunks/CjrjPegm.js";import{o as vt}from"../chunks/fqUTzOFw.js";import{p as bt,l as H,h as ht,t as F,g as t,a as _t,s as r,d as e,m as c,c as l,r as n,n as kt,f as xt,i as Mt}from"../chunks/DIjqGaOE.js";import{s as L}from"../chunks/DSOjtZ6D.js";import{i as G}from"../chunks/CQyKFiTL.js";import{e as $t,i as It}from"../chunks/DmmqpXdj.js";import{e as g,r as wt}from"../chunks/DDm2SC16.js";import{b as zt}from"../chunks/fMvjHjjw.js";import{i as Ct}from"../chunks/B7ev73gN.js";import{s as Dt,a as yt}from"../chunks/CxKmxjN7.js";import{p as J}from"../chunks/BkoTM5av.js";import{g as S}from"../chunks/D_CwC5Cj.js";import{g as K}from"../chunks/D-P7AXKl.js";import{b as A}from"../chunks/DBazd1J6.js";import{p as Lt}from"../chunks/Bu9f80X6.js";import{c as k}from"../chunks/CVsMCqo-.js";import{m as St}from"../chunks/HCEeGut2.js";import{L as At}from"../chunks/CdLx_qlF.js";var Et=x('<li class="list-group-item d-flex justify-content-between align-items-center"> <button class="btn btn-sm btn-outline-danger">Remove</button></li>'),Nt=x('<ul class="list-group mb-2"></ul>'),qt=x('<p class="text-muted">No mitigations linked yet.</p>'),Bt=x('<main class="container py-4"><button class="btn btn-link mb-3">‚Üê Back to Hazard</button> <h1 class="mb-4"> </h1> <div class="mb-3"><label for="causeDescription" class="form-label">Cause Description</label> <textarea id="causeDescription" class="form-control" rows="3" placeholder="Describe a factor that could lead to this hazard"></textarea> <div class="form-text">A cause is a factor or condition that could contribute to the hazard occurring. e.g. "A drink is spilled leaving a puddle of liquid that goes unnoticed."</div></div> <div class="mb-4"><label class="form-label">Linked Mitigations</label> <!></div> <div class="mb-3"><button class="btn btn-secondary me-2">+ Add New Mitigation</button> <button class="btn btn-outline-primary">Link Existing Mitigation</button></div> <button class="btn btn-success"> </button> <!></main>');function ia(O,Q){bt(Q,!1);const[T,U]=Dt(),v=()=>yt(St,"$mitigations",T),M=c(),E=c();let u=null,s=c(null),m=c(""),o=c([]),b=c(!1),h=c("");vt(()=>{if(u=J.url.searchParams.get("hazardID"),e(s,J.url.searchParams.get("causeID")),t(s)){const a=K(k).find(i=>i.id===t(s));a&&(e(m,a.description),e(o,a.mitigationIds||[]))}});function V(){S(A+`/workspace/hazard?id=${u}`)}function W(){k.update(a=>a.map(i=>i.id===t(s)?{...i,description:t(m),mitigationIds:t(o)}:i))}function X(){const a=K(k).length+1;e(s,`C${String(a).padStart(2,"0")}`),k.update(i=>[...i,{id:t(s),description:t(m),mitigationIds:t(o)}]),Lt.update(i=>({...i,hazards:i.hazards.map(d=>d.id===u?{...d,causeIds:[...d.causeIds||[],t(s)]}:d)}))}function N(){t(s)?W():X()}function Y(){N(),S(A+`/workspace/hazard?id=${u}`)}function Z(a){e(o,[...t(o),a])}function tt(a){e(o,t(o).filter(i=>i!==a))}function at(){N(),S(A+`/workspace/hazard/mitigation?causeID=${t(s)}&hazardID=${u}`)}function it(a){Z(a.detail),e(b,!1)}H(()=>v(),()=>{e(M,v())}),H(()=>(t(M),t(h),t(o)),()=>{e(E,t(M).filter(a=>a.description.toLowerCase().includes(t(h).toLowerCase())&&!t(o).includes(a.id)))}),ht(),Ct();var $=Bt(),q=l($),I=r(q,2),et=l(I,!0);n(I);var w=r(I,2),B=r(l(w),2);wt(B),kt(2),n(w);var z=r(w,2),st=r(l(z),2);{var ot=a=>{var i=Nt();$t(i,5,()=>t(o),It,(d,D)=>{var R=gt(),dt=xt(R);{var ut=y=>{var f=Et();const mt=Mt(()=>v().find(pt=>pt.id===t(D)));var j=l(f),ft=r(j);n(f),F(()=>L(j,`${t(mt).description??""} `)),g("click",ft,()=>tt(t(D))),p(y,f)};G(dt,y=>{v().find(f=>f.id===t(D))&&y(ut)})}p(d,R)}),n(i),p(a,i)},rt=a=>{var i=qt();p(a,i)};G(st,a=>{t(o).length?a(ot):a(rt,!1)})}n(z);var C=r(z,2),P=l(C),nt=r(P,2);n(C);var _=r(C,2),ct=l(_,!0);n(_);var lt=r(_,2);At(lt,{get show(){return t(b)},get mitigations(){return t(E)},get search(){return t(h)},set search(a){e(h,a)},$$events:{link:it,close:()=>e(b,!1)},$$legacy:!0}),n($),F(()=>{L(et,t(s)?"Edit Cause":"Add Cause"),L(ct,t(s)?"Save Changes":"Save Cause")}),g("click",q,V),zt(B,()=>t(m),a=>e(m,a)),g("click",P,at),g("click",nt,()=>e(b,!0)),g("click",_,Y),p(O,$),_t(),U()}export{ia as component};
