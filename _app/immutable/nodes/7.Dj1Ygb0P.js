var pe=Object.defineProperty;var ue=(h,n,c)=>n in h?pe(h,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):h[n]=c;var A=(h,n,c)=>ue(h,typeof n!="symbol"?n+"":n,c);import{f as N,e as V,a as U,r as be}from"../chunks/Bgrwumxt.js";import"../chunks/DhE9Dmh7.js";import{p as ve,o as ge,l as F,b as fe,t as z,d as e,a as he,s as m,c as o,e as v,m as x,g as _e,r as s}from"../chunks/BITUO3ds.js";import{s as g}from"../chunks/OzCop-J-.js";import{i as ye}from"../chunks/BH6CHFx5.js";import{e as X,i as Z}from"../chunks/BVTScTTu.js";import{r as B}from"../chunks/CGMmQ8Nh.js";import{s as H}from"../chunks/DmrStxtd.js";import{c as ee}from"../chunks/i5w7oQmI.js";import{b as xe,a as te}from"../chunks/D4bh5b3p.js";import{i as ke}from"../chunks/DYcduxHM.js";import{p as ae}from"../chunks/zUhEKtR7.js";import{p as we}from"../chunks/KPTtVCqv.js";import{i as re}from"../chunks/B94qQf-I.js";import{g as ie}from"../chunks/CvsrO4Zi.js";const f=class f{static assess(n,c){if(!Number.isInteger(n)||!Number.isInteger(c)||n<1||n>5||c<1||c>5)throw new Error("Likelihood and severity must be integers from 1 to 5.");const d=f.matrix[n-1][c-1],P=f.ratings[d],$=f.definitions[d];return{score:d,rating:P,definition:$}}};A(f,"matrix",[[1,1,2,2,3],[1,2,2,3,4],[2,2,3,3,4],[2,3,3,4,5],[3,4,4,5,5]]),A(f,"ratings",{1:"Acceptable",2:"Acceptable",3:"Undesirable",4:"Unacceptable Without Further Mitigation",5:"Unacceptable"}),A(f,"definitions",{1:"Acceptable, no further action required.",2:"Acceptable where cost of further reduction outweighs benefits gained.",3:"Undesirable level of risk: attempts should be made to eliminate or control to reduce risk to an acceptable level; shall only be acceptable when further risk reduction is impractical.",4:"Mandatory elimination or control to reduce risk to an acceptable level.",5:"Unacceptable level of risk."});let S=f;var Ie=N('<tr><td class="text-nowrap"><input type="radio" name="severity" class="form-check-input me-2"/> <strong> </strong></td><td> </td></tr>'),Me=N('<tr><td class="text-nowrap"><input type="radio" name="likelihood" class="form-check-input me-2"/> <strong> </strong></td><td> </td></tr>'),Ae=N('<div class="mt-4"><h5>Calculated Risk Rating</h5> <div> </div> <div class="form-text"> </div></div>'),Ue=N('<main class="container py-4"><button class="btn btn-link mb-3">‚Üê Back to Hazard</button> <h1 class="mb-4"> </h1> <div class="mb-3"><label for="impactDescription" class="form-label">Impact Description</label> <textarea id="impactDescription" class="form-control" rows="3" placeholder="e.g. Incorrect clinical advice leads to unsafe prescription"></textarea></div> <h5 class="mt-4">Severity</h5> <table class="table table-bordered align-middle"><tbody></tbody></table> <h5 class="mt-4">Likelihood</h5> <table class="table table-bordered align-middle"><tbody></tbody></table> <!> <button class="btn btn-success mt-4"> </button></main>');function Te(h,n){ve(n,!1);const c=x(),d=x(),P=[],$=[];let M=null,p=x(null),k=x(""),u=x(""),b=x("");const se=[{value:"Catastrophic",label:"Catastrophic",description:"Death or permanent major harm",class:"table-danger"},{value:"Major",label:"Major",description:"Temporary major harm or permanent minor harm",class:"table-warning"},{value:"Moderate",label:"Moderate",description:"Short-term harm requiring intervention",class:"table-info"},{value:"Minor",label:"Minor",description:"Minimal harm, may require monitoring",class:""},{value:"Negligible",label:"Negligible",description:"No significant harm",class:"table-secondary text-white"}],le=[{value:"Almost Certain",label:"Almost Certain",description:"Expected to occur frequently",class:"table-danger"},{value:"Likely",label:"Likely",description:"Will probably occur occasionally",class:"table-warning"},{value:"Possible",label:"Possible",description:"Could occur but uncommon",class:"table-info"},{value:"Unlikely",label:"Unlikely",description:"Rare but possible",class:""},{value:"Rare",label:"Rare",description:"Exceptional circumstances only",class:"table-secondary text-white"}],oe={1:"bg-success text-white",2:"bg-info text-dark",3:"bg-warning text-dark",4:"bg-danger text-white",5:"bg-danger text-white"},y={Catastrophic:5,Major:4,Moderate:3,Minor:2,Negligible:1,"Almost Certain":5,Likely:4,Possible:3,Unlikely:2,Rare:1};ge(()=>{if(M=ae.url.searchParams.get("hazardID"),v(p,ae.url.searchParams.get("impactID")),M||(alert("You must specify a hazard."),ie("/workspace")),e(p)){const l=_e(re).find(t=>t.id===e(p));l&&(v(k,l.description),v(u,l.severity),v(b,l.likelihood))}});function T(){ie(`/workspace/hazard?id=${M}`)}function ne(){if(!e(u)||!e(b)){alert("Please select both severity and likelihood.");return}const l=e(c),t=e(d).rating;re.update(a=>{if(e(p))return a.map(r=>r.id===e(p)?{...r,description:e(k),severity:e(u),likelihood:e(b),score:l,rating:t}:r);{const r=a.length+1,i=`I${String(r).padStart(2,"0")}`;return v(p,i),[...a,{id:i,description:e(k),severity:e(u),likelihood:e(b),score:l,rating:t}]}}),e(p)&&we.update(a=>({...a,hazards:a.hazards.map(r=>{var i;return r.id===M&&!((i=r.impactIds)!=null&&i.includes(e(p)))?{...r,impactIds:[...r.impactIds||[],e(p)]}:r})})),T()}F(()=>(e(u),e(b)),()=>{v(c,(y[e(u)]||0)*(y[e(b)]||0))}),F(()=>(e(u),e(b),S),()=>{v(d,y[e(u)]&&y[e(b)]?S.assess(y[e(b)],y[e(u)]):null)}),F(()=>(e(d),e(c)),()=>{console.log("Risk assessment:",e(d),e(c))}),fe(),ke();var j=Ue(),Y=o(j),C=m(Y,2),ce=o(C,!0);s(C);var L=m(C,2),G=m(o(L),2);be(G),s(L);var q=m(L,4),J=o(q);X(J,5,()=>se,Z,(l,t)=>{var a=Ie(),r=o(a),i=o(r);B(i);var _,w=m(i,2),R=o(w,!0);s(w),s(r);var I=m(r),O=o(I,!0);s(I),s(a),z(()=>{H(a,1,ee(e(t).class)),_!==(_=e(t).value)&&(i.value=(i.__value=e(t).value)??""),g(R,e(t).label),g(O,e(t).description)}),te(P,[],i,()=>(e(t).value,e(u)),W=>v(u,W)),U(l,a)}),s(J),s(q);var D=m(q,4),K=o(D);X(K,5,()=>le,Z,(l,t)=>{var a=Me(),r=o(a),i=o(r);B(i);var _,w=m(i,2),R=o(w,!0);s(w),s(r);var I=m(r),O=o(I,!0);s(I),s(a),z(()=>{H(a,1,ee(e(t).class)),_!==(_=e(t).value)&&(i.value=(i.__value=e(t).value)??""),g(R,e(t).label),g(O,e(t).description)}),te($,[],i,()=>(e(t).value,e(b)),W=>v(b,W)),U(l,a)}),s(K),s(D);var Q=m(D,2);{var de=l=>{var t=Ae(),a=m(o(t),2),r=o(a);s(a);var i=m(a,2),_=o(i,!0);s(i),s(t),z(()=>{H(a,1,`badge ${oe[e(d).score]}`),g(r,`${e(d).rating??""} (${e(d).score??""} pts)`),g(_,e(d).definition)}),U(l,t)};ye(Q,l=>{e(d)&&l(de)})}var E=m(Q,2),me=o(E,!0);s(E),s(j),z(()=>{g(ce,e(p)?"Edit Impact":"Add Impact"),g(me,e(p)?"Save Impact":"Add Impact")}),V("click",Y,T),xe(G,()=>e(k),l=>v(k,l)),V("click",E,ne),U(h,j),he()}export{Te as component};
